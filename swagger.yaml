openapi: 3.0.0
info:
  title: BusitPlus API
  version: 1.0.0
  description: >
    BusitPlus API documentation for the BusitPlus system.

servers:
  - url: http://localhost:3000
    description: Local development server

paths:
  /api/test/encrypt:
    post:
      summary: Encrypt Password
      description: Encrypts a plain text password using Bcrypt and returns the hashed value.
      tags:
        - Test
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  example: mypassword123
                  description: The plain text password to be encrypted.
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  example: mypassword123
                  description: The plain text password to be encrypted.
      responses:
        '200':
          description: Password encrypted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "$2b$14$p.Fv7a5PbQVrwnSgQGFfHe96gpZKB0xRPIY.PN4FvWyfvhHC08gR2"
                    description: The Bcrypt hashed password.
                  status:
                    type: boolean
                    example: true
                    description: Indicates success.
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password is required."
                    description: Error message.
                  status:
                    type: boolean
                    example: false
                    description: Indicates failure.
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "This API is not allowed in production."
                    description: Error message.
                  status:
                    type: boolean
                    example: false
                    description: Indicates failure.
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Internal server error."
                    description: Error message.
                  status:
                    type: boolean
                    example: false
                    description: Indicates failure.

  /api/test/decrypt:
    post:
      summary: Decrypt Password
      description: Decrypts a plain text password against a Bcrypt hash.
      tags:
        - Test
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
                - hash
              properties:
                password:
                  type: string
                  example: mypassword123
                  description: The plain text password to decrypt.
                hash:
                  type: string
                  example: "$2b$14$p.Fv7a5PbQVrwnSgQGFfHe96gpZKB0xRPIY.PN4FvWyfvhHC08gR2"
                  description: The Bcrypt hashed password to compare against.
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - password
                - hash
              properties:
                password:
                  type: string
                  example: mypassword123
                  description: The plain text password to decrypt.
                hash:
                  type: string
                  example: "$2b$14$p.Fv7a5PbQVrwnSgQGFfHe96gpZKB0xRPIY.PN4FvWyfvhHC08gR2"
                  description: The Bcrypt hashed password to compare against.
      responses:
        '200':
          description: Password decrypted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "The password is correct."
                    description: Verification message.
                  status:
                    type: boolean
                    example: true
                    description: Indicates success.
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password and hash are required."
                    description: Error message.
                  status:
                    type: boolean
                    example: false
                    description: Indicates failure.
        '403':
            description: Forbidden
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    message:
                      type: string
                      example: "This API is not allowed in production."
                      description: Error message.
                    status:
                      type: boolean
                      example: false
                      description: Indicates failure.
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Internal server error."
                    description: Error message.
                  status:
                    type: boolean
                    example: false
                    description: Indicates failure.

  /api/test/sendotp:
    post:
      summary: Send OTP
      description: This endpoint sends a one-time password (OTP) to a user's email address.
      tags:
        - Test
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
      responses:
        '200':
          description: OTP sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP sent successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid email input
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Please provide a valid email address.
                  status:
                    type: boolean
                    example: false
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Exceeded the OTP request limit.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An error occurred while sending OTP.
                  status:
                    type: boolean
                    example: false

  /api/test/verifyotp:
    post:
      tags:
        - Test
      summary: Verify OTP
      description: Verifies the OTP (One-Time Password) submitted by the user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - otp
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                otp:
                  type: string
                  example: "123456"
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - email
                - otp
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                otp:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: OTP is valid and verified successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP verification successful
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid OTP or bad request.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP is invalid.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Internal server error during OTP verification.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An error occurred while verifying OTP.
                  status:
                    type: boolean
                    example: false

  /api/test/sendemail:
    post:
      summary: Send Email
      description: >
        Send a test email to the specified address.
      tags:
        - Test
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: The recipient email address
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: The recipient email address
      responses:
        '200':
          description: Email sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Email sent successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid or missing email address
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Please provide a valid email address.
                  status:
                    type: boolean
                    example: false
        '403':
          description: API not allowed in production environment
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: This API is not allowed in production.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server error while sending email
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An error occurred while sending email.
                  status:
                    type: boolean
                    example: false

  /api/verifyToken:
    post:
      summary: Verify Token
      description: Verifies a JWT token from the `Authorization` header in Bearer format.
      tags:
        - Verify
      security:
        - bearerAuth: [] 
      responses:
        '200':
          description: Token verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Token is valid.
                  status:
                    type: boolean
                    example: true
        '401':
          description: Token missing or invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Authorization token is required or invalid.
                  status:
                    type: boolean
                    example: false
        '403':
          description: Token expired or malformed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid or expired token.
                  status:
                    type: boolean
                    example: false

  /api/system/resetpassword:
    post:
      summary: Reset user password
      description: Reset password using the current password. Requires the user email, current password, and new password.
      tags:
        - System
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - Users_Email
                - Current_Password
                - New_Password
              properties:
                Users_Email:
                  type: string
                  format: email
                  example: user@example.com
                Current_Password:
                  type: string
                  format: password
                  example: oldpassword123
                New_Password:
                  type: string
                  format: password
                  example: newpassword456
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - Users_Email
                - Current_Password
                - New_Password
              properties:
                Users_Email:
                  type: string
                  format: email
                  example: user@example.com
                Current_Password:
                  type: string
                  format: password
                  example: oldpassword123
                New_Password:
                  type: string
                  format: password
                  example: newpassword456
      responses:
        '200':
          description: Password reset successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password reset successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid input parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Please fill in the correct parameters as required.
                  status:
                    type: boolean
                    example: false
        '401':
          description: Current password is incorrect
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Current password is incorrect.
                  status:
                    type: boolean
                    example: false
        '404':
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User not found.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server or database error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An unexpected error occurred.
                  status:
                    type: boolean
                    example: false

  /api/system/resetpassword-request-otp:
    post:
      summary: Request OTP for resetting password
      description: Sends an OTP to the user's email address if it exists and is active in the system.
      tags:
        - System
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - Users_Email
              properties:
                Users_Email:
                  type: string
                  format: email
                  example: user@example.com
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - Users_Email
              properties:
                Users_Email:
                  type: string
                  format: email
                  example: user@example.com
      responses:
        '200':
          description: OTP request processed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP has been sent to your email.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid email input
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Please provide a valid email address.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server or email sending error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Failed to send OTP.
                  status:
                    type: boolean
                    example: false

  /api/system/resetpassword-verify-otp:
    post:
      summary: Reset password using OTP verification
      description: Verifies OTP and resets the user password if valid. Sends a notification email after successful password change.
      tags:
        - System
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - Users_Email
                - Users_Password
                - otp
              properties:
                Users_Email:
                  type: string
                  format: email
                  example: user@example.com
                Users_Password:
                  type: string
                  format: password
                  example: newpassword123
                otp:
                  type: string
                  example: 123456
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - Users_Email
                - Users_Password
                - otp
              properties:
                Users_Email:
                  type: string
                  format: email
                  example: user@example.com
                Users_Password:
                  type: string
                  format: password
                  example: newpassword123
                otp:
                  type: string
                  example: 123456
      responses:
        '200':
          description: Password reset successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password reset successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid input or OTP verification failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP is invalid or expired.
                  status:
                    type: boolean
                    example: false
        '404':
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User not found.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server or database error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An unexpected error occurred.
                  status:
                    type: boolean
                    example: false

  /api/images/profile-images/{filename}:
    get:
      summary: Get user profile image
      description: Serve a user profile image by filename.
      tags:
        - Images
      parameters:
        - name: filename
          in: path
          required: true
          schema:
            type: string
          description: Name of the image file (e.g., abc123.jpg)
      responses:
        '200':
          description: Successful image response
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
            image/png:
              schema:
                type: string
                format: binary
        '404':
          description: Image not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Image not found.

  /api/login/application:
    post:
      summary: Application login 
      description: Application Login a user with email and password, and return a JWT token.
      tags:
        - Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - Users_Email
                - Users_Password
              properties:
                Users_Email:
                  type: string
                  example: "student.admin@rmutto.ac.th"
                Users_Password:
                  type: string
                  example: "Cs12345678"
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - Users_Email
                - Users_Password
              properties:
                Users_Email:
                  type: string
                  example: "student.admin@rmutto.ac.th"
                Users_Password:
                  type: string
                  example: "Cs12345678"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    description: JWT token for authentication
                  message:
                    type: string
                    example: "The login was successful."
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid input parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Please fill in the correct parameters as required."
                  status:
                    type: boolean
                    example: false
        '401':
          description: Incorrect email or password
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "The password is incorrect."
                  status:
                    type: boolean
                    example: false
        '404':
          description: Invalid user type
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User type details not found."
                  status:
                    type: boolean
                    example: false
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "An error occurred on the server."
                  status:
                    type: boolean
                    example: false

  /api/login/website:
    post:
      tags:
        - Login
      summary: Login for Web Admin (teacher or staff)
      description: Authenticate admin users (teacher or staff) with email or username and password. Returns JWT token on success.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - Users_Email
                - Users_Password
              properties:
                Users_Email:
                  type: string
                  example: "staff.admin@rmutto.ac.th"
                Users_Password:
                  type: string
                  example: "Cs12345678"
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - Users_Email
                - Users_Password
              properties:
                Users_Email:
                  type: string
                  example: "staff.admin@rmutto.ac.th"
                Users_Password:
                  type: string
                  example: "Cs12345678"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: JWT token for authenticated requests
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  message:
                    type: string
                    example: "The login was successful."
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid input or unsupported user type
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Please fill in the correct parameters as required."
                  status:
                    type: boolean
                    example: false
        '401':
          description: Unauthorized - incorrect email or password
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Email or password is incorrect."
                  status:
                    type: boolean
                    example: false
        '404':
          description: User type details not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User type details not found."
                  status:
                    type: boolean
                    example: false
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "An error occurred on the server."
                  status:
                    type: boolean
                    example: false

  /api/timestamp/insert:
    post:
      tags:
        - Timestamp
      summary: Timestamp Insert
      description: Insert a timestamp entry into the database with Users_ID and TimestampType_ID.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - Users_ID
                - TimestampType_ID
              properties:
                Users_ID:
                  type: integer
                  example: 1
                  description: The ID of the user.
                TimestampType_ID:
                  type: integer
                  example: 1
                  description: The ID of the timestamp type.
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - Users_ID
                - TimestampType_ID
              properties:
                Users_ID:
                  type: integer
                  example: 1
                  description: The ID of the user.
                TimestampType_ID:
                  type: integer
                  example: 1
                  description: The ID of the timestamp type.
      responses:
        '200':
          description: Timestamp inserted successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Timestamp inserted successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Missing or invalid parameters.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Please fill in the correct parameters as required.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server error during timestamp insertion.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An error occurred on the server.
                  status:
                    type: boolean
                    example: false
        '501':
          description: Timestamp not inserted.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Timestamp not inserted.
                  status:
                    type: boolean
                    example: false

  /api/timestamp/get/users/{Users_ID}:
    get:
      tags:
        - Timestamp
      summary: Get timestamps by User ID
      description: Retrieve all timestamps associated with a specific user by their Users_ID.
      parameters:
        - in: path
          name: Users_ID
          required: true
          schema:
            type: integer
          description: The ID of the user.
      responses:
        '200':
          description: Successfully retrieved timestamps.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: array
                    items:
                      type: object
                      properties:
                        Timestamp_ID:
                          type: integer
                          example: 1
                        Users_ID:
                          type: integer
                          example: 1
                        Timestamp_RegisTime:
                          type: string
                          format: date-time
                          example: 2025-04-26T12:00:00Z
                        TimestampType_ID:
                          type: integer
                          example: 1
                        TimestampType_Name:
                          type: string
                          example: "timestamp_application_login"
                  status:
                    type: boolean
                    example: true
        '400':
          description: Missing or invalid Users_ID parameter.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Please fill in the correct parameters as required.
                  status:
                    type: boolean
                    example: false
        '404':
          description: No timestamps found for this user.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: No timestamps found for this user.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server error while retrieving timestamps.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An error occurred on the server.
                  status:
                    type: boolean
                    example: false

  /api/timestamp/get/type/{TimestampType_ID}:
    get:
      tags:
        - Timestamp
      summary: Get timestamps by TimestampType_ID
      description: Retrieve all timestamps associated with a specific timestamp type by its ID.
      parameters:
        - in: path
          name: TimestampType_ID
          required: true
          schema:
            type: integer
          description: The ID of the timestamp type.
      responses:
        '200':
          description: Successfully retrieved timestamps.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: array
                    items:
                      type: object
                      properties:
                        Timestamp_ID:
                          type: integer
                          example: 1
                        Users_ID:
                          type: integer
                          example: 1
                        Timestamp_RegisTime:
                          type: string
                          format: date-time
                          example: 2025-04-26T12:00:00Z
                        TimestampType_ID:
                          type: integer
                          example: 1
                        TimestampType_Name:
                          type: string
                          example: "timestamp_application_login"
                  status:
                    type: boolean
                    example: true
                    responses:
        '200':
          description: Successfully retrieved timestamps.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: array
                    items:
                      type: object
                      properties:
                        Timestamp_ID:
                          type: integer
                          example: 1
                        Users_ID:
                          type: integer
                          example: 1
                        Timestamp_RegisTime:
                          type: string
                          format: date-time
                          example: 2025-04-26T12:00:00Z
                        TimestampType_ID:
                          type: integer
                          example: 1
                        TimestampType_Name:
                          type: string
                          example: "timestamp_application_login"
                  status:
                    type: boolean
                    example: true
        '400':
          description: Missing or invalid TimestampType_ID parameter.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Please fill in the correct parameters as required.
                  status:
                    type: boolean
                    example: false
        '404':
          description: No timestamps found for this user.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: No timestamps found for this user.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server error while retrieving timestamps.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An error occurred on the server.
                  status:
                    type: boolean
                    example: false

  /api/profile/student/update:
    post:
      tags:
        - Profile
      summary: Update student profile
      description: Updates partial student profile. Requires authentication via Bearer token. Only accessible by users with type "student".
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                Student_Phone:
                  type: string
                  example: "0812345678"
                  description: Phone number in format 0XXXXXXXXX
                Student_Birthdate:
                  type: string
                  example: "21-12-2003"
                  description: Date of birth in format DD-MM-YYYY
                Student_Religion:
                  type: string
                  maxLength: 63
                  example: "พุทธ"
                Student_MedicalProblem:
                  type: string
                  maxLength: 511
                  example: "ไม่มี"
              additionalProperties: false
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                Student_Phone:
                  type: string
                  example: "0812345678"
                  description: Phone number in format 0XXXXXXXXX
                Student_Birthdate:
                  type: string
                  example: "21-12-2003"
                  description: Date of birth in format DD-MM-YYYY
                Student_Religion:
                  type: string
                  maxLength: 63
                  example: "พุทธ"
                Student_MedicalProblem:
                  type: string
                  maxLength: 511
                  example: "ไม่มี"
              additionalProperties: false
      responses:
        '200':
          description: Successfully updated student profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Student profile updated successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid input (e.g. wrong date format or too long fields)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid birthdate format. Use DD-MM-YYYY.
                  status:
                    type: boolean
                    example: false
        '403':
          description: Forbidden - user is not a student
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Permission denied. Only students can perform this action.
                  status:
                    type: boolean
                    example: false
        '404':
          description: No changes made or student not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: No changes made or student not found.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server/database error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Database error occurred.
                  status:
                    type: boolean
                    example: false

  /api/profile/teacher/update:
    post:
      tags:
        - Profile
      summary: Update teacher profile
      description: Updates partial teacher profile. Requires authentication via Bearer token. Only accessible by users with type "teacher".
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                Teacher_Phone:
                  type: string
                  example: "0812345678"
                  description: Phone number in format 0XXXXXXXXX
                Teacher_Birthdate:
                  type: string
                  example: "21-12-2003"
                  description: Date of birth in format DD-MM-YYYY
                Teacher_Religion:
                  type: string
                  maxLength: 63
                  example: "พุทธ"
                Teacher_MedicalProblem:
                  type: string
                  maxLength: 511
                  example: "ไม่มี"
              additionalProperties: false
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                Teacher_Phone:
                  type: string
                  example: "0812345678"
                  description: Phone number in format 0XXXXXXXXX
                Teacher_Birthdate:
                  type: string
                  example: "21-12-2003"
                  description: Date of birth in format DD-MM-YYYY
                Teacher_Religion:
                  type: string
                  maxLength: 63
                  example: "พุทธ"
                Teacher_MedicalProblem:
                  type: string
                  maxLength: 511
                  example: "ไม่มี"
              additionalProperties: false
      responses:
        '200':
          description: Successfully updated Teacher profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Student profile updated successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid input (e.g. wrong date format or too long fields)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid birthdate format. Use DD-MM-YYYY.
                  status:
                    type: boolean
                    example: false
        '403':
          description: Forbidden - user is not a Teacher
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Permission denied. Only Teacher can perform this action.
                  status:
                    type: boolean
                    example: false
        '404':
          description: No changes made or Teacher not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: No changes made or Teacher not found.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server/database error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Database error occurred.
                  status:
                    type: boolean
                    example: false

  /api/profile/upload/image:
    post:
      summary: Upload profile image
      description: Upload a profile image for the logged-in user. Accepts JPEG or PNG, resizes and converts to JPG before saving.
      tags:
        - Profile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                Users_ImageFile:
                  type: string
                  format: binary
              required:
                - Users_ImageFile
      responses:
        '200':
          description: Profile image uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Profile image uploaded successfully.
                  filename:
                    type: string
                    example: a2f3c1e7-1234-4567-8910-image.jpg
        '400':
          description: Bad request Missing or invalid image or token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Please provide an image file.
                  status:
                    type: boolean
                    example: false
        '404':
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User not found.
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error occurred during image upload.

  /api/profile/otherphone/add:
    post:
      tags:
        - Profile
      summary: Add an additional phone number
      description: Allows a user to add an additional phone number. Each user can have a maximum of 2 additional phone numbers.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                OtherPhone_Phone:
                  type: string
                  example: "0891234567"
              required:
                - OtherPhone_Phone
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                OtherPhone_Phone:
                  type: string
                  example: "0891234567"
              required:
                - OtherPhone_Phone
      responses:
        '200':
          description: Phone number added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Other phone number added successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid input or maximum limit reached
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: You can only have up to 2 other phone numbers.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server-side error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An error occurred on the server.
                  status:
                    type: boolean
                    example: false

  /api/profile/otherphone/delete/{OtherPhone_ID}:
    delete:
      tags:
        - Profile
      summary: Delete an additional phone number
      description: Delete an additional phone number associated with the authenticated user.
      security:
        - bearerAuth: []
      parameters:
        - name: OtherPhone_ID
          in: path
          required: true
          description: ID of the phone number to be deleted
          schema:
            type: integer
            example: 3
      responses:
        '200':
          description: Phone number deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Other phone number deleted successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid phone ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid OtherPhone_ID.
                  status:
                    type: boolean
                    example: false
        '403':
          description: Unauthorized deletion attempt
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: You do not have permission to delete this phone number.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server-side error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error deleting phone number.
                  status:
                    type: boolean
                    example: false

  /api/profile/otherphone/edit/{OtherPhone_ID}:
    put:
      tags:
        - Profile
      summary: Edit an additional phone number
      description: Update the name and number of a user's additional phone number.
      security:
        - bearerAuth: []
      parameters:
        - name: OtherPhone_ID
          in: path
          required: true
          description: ID of the additional phone number to be edited
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - OtherPhone_Name
                - OtherPhone_Phone
              properties:
                OtherPhone_Name:
                  type: string
                  example: Work Phone
                OtherPhone_Phone:
                  type: string
                  example: "0912345678"
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - OtherPhone_Name
                - OtherPhone_Phone
              properties:
                OtherPhone_Name:
                  type: string
                  example: Work Phone
                OtherPhone_Phone:
                  type: string
                  example: "0912345678"
      responses:
        '200':
          description: Phone number updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Other phone number updated successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Bad request - missing or invalid data
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid data format.
                  status:
                    type: boolean
                    example: false
        '403':
          description: Forbidden - user does not own the phone record
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: You do not have permission to edit this phone number.
                  status:
                    type: boolean
                    example: false
        '404':
          description: Phone number not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Other phone number not found.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error updating phone number.
                  status:
                    type: boolean
                    example: false

  /api/profile/otherphone/get:
    get:
      tags:
        - Profile
      summary: Get user's additional phone numbers
      description: Retrieve all other phone numbers associated with the authenticated user.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of additional phone numbers retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        OtherPhone_ID:
                          type: integer
                          example: 1
                        Users_ID:
                          type: integer
                          example: 7
                        OtherPhone_Name:
                          type: string
                          example: Emergency Contact
                        OtherPhone_Phone:
                          type: string
                          example: "0823456789"
                  message:
                    type: string
                    example: Other phone numbers retrieved successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Missing or invalid user ID from token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Missing or invalid Users_ID from token.
                  status:
                    type: boolean
                    example: false
        '404':
          description: No phone numbers found
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items: {}
                  message:
                    type: string
                    example: No other phone numbers found for this user.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An unexpected error occurred.
                  status:
                    type: boolean
                    example: false

  /api/profile/otherphone/getbyphoneid/{OtherPhone_ID}:
    get:
      tags:
        - Profile
      summary: Get other phone number by ID
      description: Retrieve a specific other phone number associated with the authenticated user by its ID.
      security:
        - bearerAuth: []
      parameters:
        - name: OtherPhone_ID
          in: path
          required: true
          schema:
            type: integer
            example: 2
          description: The ID of the other phone number to retrieve.
      responses:
        '200':
          description: Other phone number retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  OtherPhone_ID:
                    type: integer
                    example: 2
                  Users_ID:
                    type: integer
                    example: 7
                  OtherPhone_Name:
                    type: string
                    example: Emergency Contact
                  OtherPhone_Phone:
                    type: string
                    example: "0812345678"
                  message:
                    type: string
                    example: Other phone number retrieved successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid OtherPhone_ID parameter.
                  status:
                    type: boolean
                    example: false
        '404':
          description: Phone number not found or does not belong to the user
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Other phone number not found or access denied.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An unexpected error occurred.
                  status:
                    type: boolean
                    example: false

  /api/profile/data/get:
    post:
      summary: Get user profile data by token
      description: Returns the profile data of the user based on decoded token (student, teacher, or staff).
      tags:
        - Profile
      security:
        - bearerAuth: [] 
      responses:
        '200':
          description: Profile data retrieved successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  Student_ID:
                    type: integer
                    example: 123
                  Student_Code:
                    type: string
                    example: "122122211222-1"
                  Student_FirstName:
                    type: string
                    example: "Shogun"
                  Student_LastName:
                    type: string
                    example: "Phrabadang"
                  Student_Phone:
                    type: string
                    example: "0812345678"
                  Student_AcademicYear:
                    type: string
                    example: "2025"
                  Student_RegisTime:
                    type: string
                    format: date-time
                    example: "2025-04-26T10:52:54.000Z"
                  Student_IsGraduated:
                    type: boolean
                    example: false
                  Users_ID:
                    type: integer
                    example: 123
                  Teacher_ID:
                    type: integer
                    example: 456
                  Department_ID:
                    type: integer
                    example: 789
                  Users_Type_Table:
                    type: string
                    example: "student"
                  message:
                    type: string
                    example: "Profile data retrieved successfully."
                  status:
                    type: boolean
                    example: false
        '400':
          description: Bad request due to missing or invalid parameters.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Please fill in the correct parameters as required."
                  status:
                    type: boolean
                    example: false
        '404':
          description: No profile data found for this user.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "No profile data found for this user."
                  status:
                    type: boolean
                    example: false
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "An unexpected error occurred."
                  status:
                    type: boolean
                    example: false

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
