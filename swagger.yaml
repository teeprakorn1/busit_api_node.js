openapi: 3.0.0
info:
  title: BusitPlus API
  version: 1.0.0
  description: >
    BusitPlus API documentation for the BusitPlus system.

servers:
  - url: http://localhost:3000
    description: Local development server

paths:
  /api/test/encrypt:
    post:
      summary: Encrypt Password
      description: Encrypts a plain text password using Bcrypt and returns the hashed value.
      tags:
        - Test
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  example: mypassword123
                  description: The plain text password to be encrypted.
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  example: mypassword123
                  description: The plain text password to be encrypted.
      responses:
        '200':
          description: Password encrypted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "$2b$14$p.Fv7a5PbQVrwnSgQGFfHe96gpZKB0xRPIY.PN4FvWyfvhHC08gR2"
                    description: The Bcrypt hashed password.
                  status:
                    type: boolean
                    example: true
                    description: Indicates success.
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password is required."
                    description: Error message.
                  status:
                    type: boolean
                    example: false
                    description: Indicates failure.
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "This API is not allowed in production."
                    description: Error message.
                  status:
                    type: boolean
                    example: false
                    description: Indicates failure.
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Internal server error."
                    description: Error message.
                  status:
                    type: boolean
                    example: false
                    description: Indicates failure.

  /api/test/decrypt:
    post:
      summary: Decrypt Password
      description: Decrypts a plain text password against a Bcrypt hash.
      tags:
        - Test
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
                - hash
              properties:
                password:
                  type: string
                  example: mypassword123
                  description: The plain text password to decrypt.
                hash:
                  type: string
                  example: "$2b$14$p.Fv7a5PbQVrwnSgQGFfHe96gpZKB0xRPIY.PN4FvWyfvhHC08gR2"
                  description: The Bcrypt hashed password to compare against.
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - password
                - hash
              properties:
                password:
                  type: string
                  example: mypassword123
                  description: The plain text password to decrypt.
                hash:
                  type: string
                  example: "$2b$14$p.Fv7a5PbQVrwnSgQGFfHe96gpZKB0xRPIY.PN4FvWyfvhHC08gR2"
                  description: The Bcrypt hashed password to compare against.
      responses:
        '200':
          description: Password decrypted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "The password is correct."
                    description: Verification message.
                  status:
                    type: boolean
                    example: true
                    description: Indicates success.
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password and hash are required."
                    description: Error message.
                  status:
                    type: boolean
                    example: false
                    description: Indicates failure.
        '403':
            description: Forbidden
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    message:
                      type: string
                      example: "This API is not allowed in production."
                      description: Error message.
                    status:
                      type: boolean
                      example: false
                      description: Indicates failure.
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Internal server error."
                    description: Error message.
                  status:
                    type: boolean
                    example: false
                    description: Indicates failure.

  /api/verifyToken:
    post:
      summary: Verify Token
      description: Verifies a JWT token from the `Authorization` header in Bearer format.
      tags:
        - Verify
      security:
        - bearerAuth: [] 
      responses:
        '200':
          description: Token verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Token is valid.
                  status:
                    type: boolean
                    example: true
        '401':
          description: Token missing or invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Authorization token is required or invalid.
                  status:
                    type: boolean
                    example: false
        '403':
          description: Token expired or malformed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid or expired token.
                  status:
                    type: boolean
                    example: false

  /api/login/application:
    post:
      summary: Application login 
      description: Application Login a user with email and password, and return a JWT token.
      tags:
        - Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - Users_Email
                - Users_Password
              properties:
                Users_Email:
                  type: string
                  example: "student.admin@rmutto.ac.th"
                Users_Password:
                  type: string
                  example: "Cs12345678"
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - Users_Email
                - Users_Password
              properties:
                Users_Email:
                  type: string
                  example: "student.admin@rmutto.ac.th"
                Users_Password:
                  type: string
                  example: "Cs12345678"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    description: JWT token for authentication
                  message:
                    type: string
                    example: "The login was successful."
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid input parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Please fill in the correct parameters as required."
                  status:
                    type: boolean
                    example: false
        '401':
          description: Incorrect email or password
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "The password is incorrect."
                  status:
                    type: boolean
                    example: false
        '404':
          description: Invalid user type
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User type details not found."
                  status:
                    type: boolean
                    example: false
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "An error occurred on the server."
                  status:
                    type: boolean
                    example: false

  /api/otp/sendotp:
    post:
      summary: Send OTP
      description: This endpoint sends a one-time password (OTP) to a user's email address.
      tags:
        - OTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
      responses:
        '200':
          description: OTP sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP sent successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid email input
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Please provide a valid email address.
                  status:
                    type: boolean
                    example: false
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Exceeded the OTP request limit.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An error occurred while sending OTP.
                  status:
                    type: boolean
                    example: false


  /api/otp/verifyotp:
    post:
      tags:
        - OTP
      summary: Verify OTP
      description: Verifies the OTP (One-Time Password) submitted by the user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - otp
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                otp:
                  type: string
                  example: "123456"
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - email
                - otp
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                otp:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: OTP is valid and verified successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP verification successful
                  status:
                    type: boolean
                    example: true
        '400':
          description: Invalid OTP or bad request.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP is invalid.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Internal server error during OTP verification.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An error occurred while verifying OTP.
                  status:
                    type: boolean
                    example: false

  /api/timestamp/insert:
    post:
      tags:
        - Timestamp
      summary: Timestamp Insert
      description: Insert a timestamp entry into the database with Users_ID and TimestampType_ID.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - Users_ID
                - TimestampType_ID
              properties:
                Users_ID:
                  type: integer
                  example: 1
                  description: The ID of the user.
                TimestampType_ID:
                  type: integer
                  example: 1
                  description: The ID of the timestamp type.
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - Users_ID
                - TimestampType_ID
              properties:
                Users_ID:
                  type: integer
                  example: 1
                  description: The ID of the user.
                TimestampType_ID:
                  type: integer
                  example: 1
                  description: The ID of the timestamp type.
      responses:
        '200':
          description: Timestamp inserted successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Timestamp inserted successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Missing or invalid parameters.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Please fill in the correct parameters as required.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server error during timestamp insertion.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An error occurred on the server.
                  status:
                    type: boolean
                    example: false
        '501':
          description: Timestamp not inserted.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Timestamp not inserted.
                  status:
                    type: boolean
                    example: false

  /api/timestamp/get/users/{Users_ID}:
    get:
      tags:
        - Timestamp
      summary: Get timestamps by User ID
      description: Retrieve all timestamps associated with a specific user by their Users_ID.
      parameters:
        - in: path
          name: Users_ID
          required: true
          schema:
            type: integer
          description: The ID of the user.
      responses:
        '200':
          description: Successfully retrieved timestamps.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: array
                    items:
                      type: object
                      properties:
                        Timestamp_ID:
                          type: integer
                          example: 1
                        Users_ID:
                          type: integer
                          example: 1
                        Timestamp_RegisTime:
                          type: string
                          format: date-time
                          example: 2025-04-26T12:00:00Z
                        TimestampType_ID:
                          type: integer
                          example: 1
                        TimestampType_Name:
                          type: string
                          example: "timestamp_application_login"
                  status:
                    type: boolean
                    example: true
        '400':
          description: Missing or invalid Users_ID parameter.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Please fill in the correct parameters as required.
                  status:
                    type: boolean
                    example: false
        '404':
          description: No timestamps found for this user.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: No timestamps found for this user.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server error while retrieving timestamps.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An error occurred on the server.
                  status:
                    type: boolean
                    example: false

  /api/timestamp/get/type/{TimestampType_ID}:
    get:
      tags:
        - Timestamp
      summary: Get timestamps by TimestampType_ID
      description: Retrieve all timestamps associated with a specific timestamp type by its ID.
      parameters:
        - in: path
          name: TimestampType_ID
          required: true
          schema:
            type: integer
          description: The ID of the timestamp type.
      responses:
        '200':
          description: Successfully retrieved timestamps.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: array
                    items:
                      type: object
                      properties:
                        Timestamp_ID:
                          type: integer
                          example: 1
                        Users_ID:
                          type: integer
                          example: 1
                        Timestamp_RegisTime:
                          type: string
                          format: date-time
                          example: 2025-04-26T12:00:00Z
                        TimestampType_ID:
                          type: integer
                          example: 1
                        TimestampType_Name:
                          type: string
                          example: "timestamp_application_login"
                  status:
                    type: boolean
                    example: true
                    responses:
        '200':
          description: Successfully retrieved timestamps.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: array
                    items:
                      type: object
                      properties:
                        Timestamp_ID:
                          type: integer
                          example: 1
                        Users_ID:
                          type: integer
                          example: 1
                        Timestamp_RegisTime:
                          type: string
                          format: date-time
                          example: 2025-04-26T12:00:00Z
                        TimestampType_ID:
                          type: integer
                          example: 1
                        TimestampType_Name:
                          type: string
                          example: "timestamp_application_login"
                  status:
                    type: boolean
                    example: true
        '400':
          description: Missing or invalid TimestampType_ID parameter.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Please fill in the correct parameters as required.
                  status:
                    type: boolean
                    example: false
        '404':
          description: No timestamps found for this user.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: No timestamps found for this user.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Server error while retrieving timestamps.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An error occurred on the server.
                  status:
                    type: boolean
                    example: false
                
  /api/profile/otherphone/add:
    post:
      tags:
        - Profile
      summary: Add other phone number for a user
      description: Add an additional phone number for a specified user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - Users_ID
                - OtherPhone_Phone
              properties:
                Users_ID:
                  type: integer
                  example: 1
                OtherPhone_Phone:
                  type: string
                  example: "0123456789"
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - Users_ID
                - OtherPhone_Phone
              properties:
                Users_ID:
                  type: integer
                  example: 1
                OtherPhone_Phone:
                  type: string
                  example: "0123456789"
      responses:
        '200':
          description: Other phone number added successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Other phone number added successfully.
                  status:
                    type: boolean
                    example: true
        '400':
          description: Bad Request - Incorrect parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Please fill in the correct parameters as required.
                  status:
                    type: boolean
                    example: false
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: An error occurred on the server.
                  status:
                    type: boolean
                    example: false
        '501':
          description: Not Implemented - Other phone number not added
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Other phone number not added.
                  status:
                    type: boolean
                    example: false

  /api/profile/otherphone/get/{Users_ID}:
    get:
      summary: "Get other phone numbers for a user"
      tags:
        - Profile
      description: "Retrieve all other phone numbers associated with a specific user by their Users_ID."
      parameters:
        - name: "Users_ID"
          in: "path"
          required: true
          type: "string"
          example: "1"
          description: "The ID of the user whose other phone numbers are being retrieved."
      responses:
        '200':
          description: "Successfully retrieved other phone numbers."
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  message:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        OtherPhone_ID:
                          type: "integer"
                          example: 1
                          description: "The unique ID of the other phone number."
                        Users_ID:
                          type: "string"
                          example: 123
                          description: "The ID of the user."
                        OtherPhone_Phone:
                          type: "string"
                          example: 0812345678
                          description: "The other phone number."
                  status:
                    type: "boolean"
                    description: "Indicates if the request was successful."
                    example: true
        '400':
          description: "Bad request. Missing or invalid parameters."
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  message:
                    type: "string"
                    description: "Explanation of what went wrong."
                    example: "Please fill in the correct parameters as required."
                  status:
                    type: "boolean"
                    example: false
        '404':
          description: "No other phone numbers found for this user."
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  message:
                    type: "string"
                    description: "Explanation of the result."
                    example: "No other phone numbers found for this user."
                  status:
                    type: "boolean"
                    example: false
        '500':
          description: "Internal server error. An unexpected error occurred."
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  message:
                    type: "string"
                    description: "Explanation of what went wrong."
                    example: "An unexpected error occurred."
                  status:
                    type: "boolean"
                    example: false

  /api/profile/data/get:
    post:
      summary: Get user profile data by token
      description: Returns the profile data of the user based on decoded token (student, teacher, or staff).
      tags:
        - Profile
      security:
        - bearerAuth: [] 
      responses:
        '200':
          description: Profile data retrieved successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  Student_ID:
                    type: integer
                    example: 123
                  Student_Code:
                    type: string
                    example: "122122211222-1"
                  Student_FirstName:
                    type: string
                    example: "Shogun"
                  Student_LastName:
                    type: string
                    example: "Phrabadang"
                  Student_Phone:
                    type: string
                    example: "0812345678"
                  Student_AcademicYear:
                    type: string
                    example: "2025"
                  Student_RegisTime:
                    type: string
                    format: date-time
                    example: "2025-04-26T10:52:54.000Z"
                  Student_IsGraduated:
                    type: boolean
                    example: false
                  Users_ID:
                    type: integer
                    example: 123
                  Teacher_ID:
                    type: integer
                    example: 456
                  Department_ID:
                    type: integer
                    example: 789
                  Users_Type_Table:
                    type: string
                    example: "student"
                  message:
                    type: string
                    example: "Profile data retrieved successfully."
                  status:
                    type: boolean
                    example: false
        '400':
          description: Bad request due to missing or invalid parameters.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Please fill in the correct parameters as required."
                  status:
                    type: boolean
                    example: false
        '404':
          description: No profile data found for this user.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "No profile data found for this user."
                  status:
                    type: boolean
                    example: false
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "An unexpected error occurred."
                  status:
                    type: boolean
                    example: false

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
