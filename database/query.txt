CREATE DATABASE IF NOT EXISTS busitplus CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE busitplus;

CREATE TABLE IF NOT EXISTS Users(
	Users_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    Users_Email VARCHAR(255) NOT NULL,
    Users_Username VARCHAR(63) NOT NULL,
    Users_Password VARCHAR(127) NOT NULL,
    Users_RegisTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    Users_ImageFile VARCHAR(255),
    Users_Type VARCHAR(15) NOT NULL,
    Users_IsActive BOOLEAN NOT NULL DEFAULT TRUE
);

CREATE TABLE IF NOT EXISTS Faculty(
	Faculty_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    Faculty_Name VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS Department(
	Department_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    Department_Name VARCHAR(255) NOT NULL UNIQUE,
    Faculty_ID INT(13) NOT NULL,
	FOREIGN KEY (Faculty_ID) REFERENCES Faculty(Faculty_ID)
);

CREATE TABLE IF NOT EXISTS Staff(
	Staff_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    Staff_Code CHAR(15) NOT NULL UNIQUE,
    Staff_FirstName VARCHAR(63) NOT NULL,
    Staff_LastName VARCHAR(63) NOT NULL,
    Staff_Phone CHAR(15),
    Staff_RegisTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    Staff_IsResign BOOLEAN NOT NULL DEFAULT FALSE,
    Users_ID INT(13) NOT NULL,
    FOREIGN KEY (Users_ID) REFERENCES Users(Users_ID)
);

CREATE TABLE IF NOT EXISTS Teacher(
	Teacher_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    Teacher_Code CHAR(15) NOT NULL UNIQUE,
    Teacher_FirstName VARCHAR(63) NOT NULL,
    Teacher_LastName VARCHAR(63) NOT NULL,
    Teacher_Phone CHAR(15),
    Teacher_Birthdate DATE,
    Teacher_Religion VARCHAR(63),
    Teacher_MedicalProblem VARCHAR(511),
    Teacher_RegisTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    Teacher_IsResign BOOLEAN NOT NULL DEFAULT FALSE,
    Teacher_IsDean BOOLEAN NOT NULL DEFAULT FALSE,
    Users_ID INT(13) NOT NULL,
    Department_ID INT(13) NOT NULL,
    FOREIGN KEY (Users_ID) REFERENCES Users(Users_ID),
    FOREIGN KEY (Department_ID) REFERENCES Department(Department_ID)
);

CREATE TABLE IF NOT EXISTS Student(
	Student_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    Student_Code CHAR(15) NOT NULL UNIQUE,
    Student_FirstName VARCHAR(63) NOT NULL,
    Student_LastName VARCHAR(63) NOT NULL,
    Student_Phone CHAR(15),
    Student_AcademicYear YEAR NOT NULL,
    Student_Birthdate DATE,
    Student_Religion VARCHAR(63),
    Student_MedicalProblem VARCHAR(511),
    Student_RegisTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    Student_IsGraduated BOOLEAN NOT NULL DEFAULT FALSE,
    Users_ID INT(13) NOT NULL,
    Teacher_ID INT(13) NOT NULL,
    Department_ID INT(13) NOT NULL,
    FOREIGN KEY (Users_ID) REFERENCES Users(Users_ID),
    FOREIGN KEY (Teacher_ID) REFERENCES Teacher(Teacher_ID),
    FOREIGN KEY (Department_ID) REFERENCES Department(Department_ID)
);

CREATE TABLE IF NOT EXISTS DataEditType(
	DataEditType_ID TINYINT(11) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    DataEditType_Name VARCHAR(255) NOT NULL
);

CREATE TABLE IF NOT EXISTS DataEdit(
	DataEdit_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    DataEdit_ThisId INT(13) NOT NULL,
    DataEdit_RegisTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    DataEdit_Name VARCHAR(511),
    DataEdit_IP_Address VARCHAR(45),
    DataEdit_UserAgent VARCHAR(1023),
    Staff_ID INT(13) NOT NULL,
    DataEditType_ID TINYINT(11) NOT NULL,
    FOREIGN KEY (Staff_ID) REFERENCES Staff(Staff_ID),
    FOREIGN KEY (DataEditType_ID) REFERENCES DataEditType(DataEditType_ID)
);

CREATE TABLE IF NOT EXISTS OtherPhone(
	OtherPhone_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    OtherPhone_Name VARCHAR(63) NOT NULL,
    OtherPhone_Phone VARCHAR(15) NOT NULL,
    Users_ID INT(13) NOT NULL,
    FOREIGN KEY (Users_ID) REFERENCES Users(Users_ID)
);

CREATE TABLE IF NOT EXISTS TimestampType(
	TimestampType_ID TINYINT(7) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    TimestampType_Name VARCHAR(63) NOT NULL
);

CREATE TABLE IF NOT EXISTS Timestamp(
	Timestamp_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    Timestamp_RegisTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    Timestamp_Name VARCHAR(511),
    Timestamp_IP_Address VARCHAR(45),
    Timestamp_UserAgent VARCHAR(1023),
    Users_ID INT(13) NOT NULL,
    TimestampType_ID TINYINT(7) NOT NULL,
    FOREIGN KEY (Users_ID) REFERENCES Users(Users_ID),
    FOREIGN KEY (TimestampType_ID) REFERENCES TimestampType(TimestampType_ID)
);

CREATE TABLE IF NOT EXISTS ActivityStatus(
	ActivityStatus_ID TINYINT(11) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    ActivityStatus_Name VARCHAR(63) NOT NULL 
);

CREATE TABLE IF NOT EXISTS Activity(
	Activity_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    Activity_Title VARCHAR(255) NOT NULL,
    Activity_Description VARCHAR(1023) NOT NULL,
    Activity_LocationGPS POINT,
    Activity_LocationDetail VARCHAR(255),
    Activity_Total INT(13),
    Activity_StartTime DATETIME NOT NULL,
    Activity_EndTime DATETIME NOT NULL,
    Activity_RegisTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    Activity_Certificate VARCHAR(255),
    Activity_ImageFile VARCHAR(255),
    Activity_IsRequire BOOLEAN NOT NULL NOT NULL DEFAULT FALSE,
    Staff_ID INT(13),
    ActivityStatus_ID TINYINT(11),
    FOREIGN KEY (Staff_ID) REFERENCES Staff(Staff_ID),
    FOREIGN KEY (ActivityStatus_ID) REFERENCES ActivityStatus(ActivityStatus_ID)
);

CREATE TABLE IF NOT EXISTS ActivityDetail (
    ActivityDetail_ID INT(13) NOT NULL,
    Department_ID INT(13) NOT NULL,
    ActivityDetail_Total INT(13) NOT NULL,
    PRIMARY KEY (ActivityDetail_ID, Department_ID)
);

CREATE TABLE IF NOT EXISTS RegistrationStatus(
	RegistrationStatus_ID TINYINT(11) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    RegistrationStatus_Name VARCHAR(63) NOT NULL 
);

CREATE TABLE IF NOT EXISTS Registration (
    Users_ID INT(13) NOT NULL,
    Activity_ID INT(13) NOT NULL,
    Registration_RegisTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    Registration_CheckInTime DATETIME,
    Registration_CheckOutTime DATETIME,
    RegistrationStatus_ID TINYINT(11),
    PRIMARY KEY (Users_ID, Activity_ID),
    FOREIGN KEY (RegistrationStatus_ID) REFERENCES RegistrationStatus(RegistrationStatus_ID)
);

CREATE TABLE IF NOT EXISTS RegistrationPictureStatus(
	RegistrationPictureStatus_ID TINYINT(11) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    RegistrationPictureStatus_Name VARCHAR(63) NOT NULL 
);

CREATE TABLE IF NOT EXISTS RegistrationPicture (
    RegistrationPicture_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    RegistrationPicture_ImageFile VARCHAR(255) NOT NULL,
    RegistrationPicture_RegisTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    Users_ID INT(13),
    Activity_ID INT(13),
    RegistrationPictureStatus_ID TINYINT(11),
    FOREIGN KEY (Users_ID) REFERENCES Users(Users_ID),
    FOREIGN KEY (Activity_ID) REFERENCES Activity(Activity_ID),
    FOREIGN KEY (RegistrationPictureStatus_ID) REFERENCES RegistrationPictureStatus(RegistrationPictureStatus_ID)
);

CREATE TABLE IF NOT EXISTS UsersForgetPassword(
	UsersForgetPassword_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    RegistrationPicture_RegisTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    Users_ID INT(13),
    FOREIGN KEY (Users_ID) REFERENCES Users(Users_ID)
);

CREATE TABLE IF NOT EXISTS Evaluation(
	Evaluation_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    Evaluation_Title VARCHAR(255) NOT NULL,
	Evaluation_Detail VARCHAR(1023) NOT NULL,
    Activity_ID INT(13),
    FOREIGN KEY (Activity_ID) REFERENCES Activity(Activity_ID)
);

CREATE TABLE IF NOT EXISTS Question(
	Question_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    Question_Titile VARCHAR(511) NOT NULL,
    Question_Detail VARCHAR(1023) NOT NULL,
    Evaluation_ID INT(13),
    FOREIGN KEY (Evaluation_ID) REFERENCES Evaluation(Evaluation_ID)
);

CREATE TABLE IF NOT EXISTS QuestionDetail(
	QuestionDetail_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    QuestionDetail_Rating INT(1) NOT NULL,
    QuestionDetail_RegisTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    QuestionDetail_Suggestion VARCHAR(1023) NOT NULL,
    Question_ID INT(13),
    Users_ID INT(13),
    FOREIGN KEY (Question_ID) REFERENCES Question(Question_ID),
    FOREIGN KEY (Users_ID) REFERENCES Users(Users_ID)
);

CREATE TABLE IF NOT EXISTS Notification(
	Notifications_ID INT(13) NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    Notification_Detail VARCHAR(511) NOT NULL,
    Notification_RegisTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	Users_ID INT(13),
    Activity_ID INT(13),
    FOREIGN KEY (Users_ID) REFERENCES Users(Users_ID),
    FOREIGN KEY (Activity_ID) REFERENCES Activity(Activity_ID)
);

INSERT INTO faculty (Faculty_Name) 
VALUES ('บริหารธุรกิจและเทคโนโลยีสารสนเทศ'),('ศิลปศาสตร์');

INSERT INTO department (Department_Name, Faculty_ID) VALUES
('วิทยาการคอมพิวเตอร์', 1),
('เทคโนโลยีสารสนเทศ', 1),
('การตลาด', 1),
('การตลาด (2 ปี ต่อเนื่อง)', 1),
('การจัดการ', 1),
('การจัดการ (2 ปี ต่อเนื่อง)', 1),
('เทคโนโลยีโลจิสติกส์และการจัดการระบบขนส่ง', 1),
('เศรษฐศาสตร์', 1),
('การโฆษณาและประชาสัมพันธ์', 1),
('ระบบสารสนเทศทางคอมพิวเตอร์-คอมพิวเตอร์ธุรกิจ', 1),
('ระบบสารสนเทศทางคอมพิวเตอร์-คอมพิวเตอร์ธุรกิจ (2 ปี ต่อเนื่อง)', 1),
('การบัญชี', 1),
('การบัญชี (2 ปี ต่อเนื่อง)', 1),
('เทคโนโลยีคอมพิวเตอร์', 1),
('มัลติมีเดีย', 1);

INSERT INTO department (Department_Name, Faculty_ID) VALUES
('ภาษาอังกฤษเพื่อการสื่อสารสากล', 2),
('การท่องเที่ยวและการโรงแรม (แขนงการท่องเที่ยว)', 2),
('การท่องเที่ยวและการโรงแรม (แขนงการโรงแรม)', 2),
('การจัดการธุรกิจและเทคโนโลยีการกีฬา', 2),
('คณิตศาสตร์และวิทยาศาสตร์', 2),
('ภาษาไทย', 2),
('ภาษาจีน', 2);

INSERT INTO users (Users_Email, Users_Username, Users_Password, Users_Type) VALUES 
('teacher.admin@rmutto.ac.th', 'teacher.admin', '$2b$14$RrGcVoydiDD0j5Bdthqtxek0NVcz2qg3G7gLEHvm7zqrvtzhu3auS', 'teacher'),
('student.admin@rmutto.ac.th', 'student.admin', '$2b$14$RrGcVoydiDD0j5Bdthqtxek0NVcz2qg3G7gLEHvm7zqrvtzhu3auS', 'student'),
('staff.admin@rmutto.ac.th', 'staff.admin', '$2b$14$RrGcVoydiDD0j5Bdthqtxek0NVcz2qg3G7gLEHvm7zqrvtzhu3auS', 'staff');

INSERT INTO teacher (Teacher_Code, Teacher_FirstName, Teacher_LastName, Users_ID, Department_ID)
VALUES ('111111111111-1', 'Teacher', 'Admin', '1', '1');

INSERT INTO student (Student_Code, Student_FirstName, Student_LastName, Student_AcademicYear, Users_ID, Teacher_ID, Department_ID)
VALUES ('222222222222-2', 'Student', 'Admin', '2025', '2', '1', '1');

INSERT INTO staff (Staff_Code, Staff_FirstName, Staff_LastName, Users_ID)
VALUES ('333333333333-3', 'Staff', 'Admin', '3');

INSERT INTO timestamptype (TimestampType_Name)
VALUES ('timestamp_application_login'),('timestamp_website_login'),
('timestamp_application_logout'),('timestamp_website_logout'),
('timestamp_application_resetpassword'),('timestamp_application_update_profile_data'),
('timestamp_application_update_profile_image'),('timestamp_add_otherphone_users'),
('timestamp_update_otherphone_users'),('timestamp_delete_otherphone_users'),
('timestamp_application_request_otp'),('timestamp_application_resetpassword_otp'),
('timestamp_application_verify_otp'),('timestamp_website_add_student'),('timestamp_website_add_teacher'),
('timestamp_website_add_csv_student'),('timestamp_website_add_csv_teacher'),
('timestamp_website_add_staff'),('timestamp_website_add_csv_staff');

INSERT INTO dataedittype (DataEditType_Name) VALUES 
('dataedit_users_status_change'),('dataedit_student_data_update'),
('dataedit_teacher_data_update'),('dataedit_staff_data_update'),
('dataedit_profile_update'),('dataedit_system_action');